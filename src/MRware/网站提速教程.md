# æé«˜ç½‘ç«™åŠ è½½é€Ÿåº¦ï¼Œé¿å…ç”¨æˆ·ç„¦å¤´çƒ‚é¢

## ä¸€ã€æœåŠ¡å™¨ä¸Šçš„é…ç½®

### CDNç¼“å­˜

æå‰ä»åŸæœåŠ¡å™¨è·å–åˆ°ç½‘ç«™èµ„æºï¼Œè½¬å‘ç¼“å­˜åˆ°å…¨å›½å„åœ°çš„CDNèŠ‚ç‚¹ï¼Œç”¨æˆ·åœ¨è¿›è¡Œç½‘ç«™è®¿é—®æ—¶ï¼Œå°±å¯ä»¥å°±è¿‘é€‰æ‹©æœ€è¿‘çš„èŠ‚ç‚¹è·å–èµ„æºï¼Œé¿å…è¿œè·ç¦»ä¼ è¾“çš„æ•ˆç‡ä½ä¸‹é—®é¢˜ã€‚

![image-20250808001712807](https://yhyper.dpdns.org/photostore/2025/08/image-20250808001712807.png)

ä¼˜ç‚¹ï¼šå»¶è¿Ÿæ›´ä½ã€å…è®¸æ›´å¤šäººè®¿é—®

ç¼ºç‚¹ï¼šåœ¨æœåŠ¡å™¨ä¸Šè®¾ç½®å¥½ç¼“å­˜è§„åˆ™ï¼Œå¦åˆ™ä¼šè¢«æ¶æ„åˆ·å–æµé‡ï¼ˆæŒ‰æµé‡è®¡è´¹ï¼Œè´µï¼‰

### æµè§ˆå™¨ç¼“å­˜

æ›´ç›´æ¥çš„æ–¹æ³•ï¼Œåœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®åç¼“å­˜åˆ°æœ¬åœ°ï¼Œä¸‹ä¸€æ¬¡è®¿é—®æ—¶ç›´æ¥æœ¬åœ°åŠ è½½

ç¼“å­˜çš„å†…å®¹å¯ä»¥æ ¹æ®ç±»å‹ä¸åŒï¼Œè®¾ç½®ä¸ä¸€æ ·çš„æ—¶é—´ï¼Œä¾‹å¦‚é™æ€èµ„æºï¼Œå¯ä»¥æé•¿æ—¶é—´ç¼“å­˜ï¼ˆ1å¹´ä»¥ä¸Šï¼‰ï¼›åŠ¨æ€èµ„æºï¼Œhtmlé¡µé¢ï¼ˆå¯ä»¥è®¾ç½®å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰ï¼›æ•æ„Ÿèµ„æºç­‰ï¼Œä¸è¿›è¡Œç¼“å­˜ï¼Œé¿å…æ³„éœ²ã€‚

### å‡çº§HTTP2

HTTP1å¤„ç†é€»è¾‘æ˜¯ä¸²è¡Œå¤„ç†ï¼Œè™½ç„¶å¯ä»¥å»ºç«‹å¤šä¸ªè¿æ¥ï¼Œä½†æ˜¯è¿æ¥å†…çš„è¯·æ±‚è¦æŒ‰é¡ºåºå¤„ç†ï¼Œå®¹æ˜“äº§ç”Ÿé˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œè€ŒHTTP2å¯ä»¥å¤šè·¯å¤ç”¨ï¼ŒçœŸæ­£æ„ä¹‰ä¸Šåœ¨å•ä¸ªè¿æ¥ä¸Šå¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œå®ç°å¹¶è¡Œå¤„ç†

1.å¯åœ¨å®å¡”ç½‘ç«™ä¸­çš„é…ç½®æ–‡ä»¶å¤„ï¼Œæ·»åŠ ä¸€è¡Œä»£ç å³å¯

2.å¦‚æœä½¿ç”¨CDNï¼Œå¯ä»¥åœ¨CDNä¸­è‡ªè¡Œå‹¾é€‰æ‰“å¡è¿™ä¸ªé…ç½®

![image-20250808002156221](https://yhyper.dpdns.org/photostore/2025/08/image-20250808002156221.png)

å®å¡”ä¸­çš„é…ç½®

![image-20250808002411464](https://yhyper.dpdns.org/photostore/2025/08/image-20250808002411464.png)

```
#å…³é”®:åœ¨443ç«¯å£åæ·»åŠ  http2
listen 443 ssl http2;
```

å½“ç„¶ï¼ŒHTTP3ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œç†è®ºä¸Šå»ºç«‹è¿æ¥é€Ÿåº¦æ›´å¿«ï¼Œå®Œå…¨è§£å†³é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œä¸è¿‡å…¼å®¹æ€§å’Œç¨³å®šæ€§æœ‰å¾…éªŒè¯ï¼Œæš‚æ—¶ä¸è€ƒè™‘

## äºŒã€ç½‘ç«™æœ¬ä½“ä¿®æ”¹

### é™æ€èµ„æºå‹ç¼©

å¯¹äºç½‘ç«™çš„é™æ€èµ„æºå¦‚å›¾ç‰‡è§†é¢‘ï¼Œå¤§å®¶ä¹Ÿéƒ½æ¸…æ¥šï¼Œä½“ç§¯è¶Šå¤§ï¼Œä¼ è¾“é€Ÿåº¦è¶Šæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†è¿™äº›å†…å®¹è¿›è¡Œå‹ç¼©ã€‚

jpgã€pngç­‰å›¾ç‰‡å¯ä»¥è¿›è¡Œwebpæ ¼å¼å‹ç¼©ï¼Œèƒ½å‡å°‘20%-90%å·¦å³çš„ä½“ç§¯ã€‚

ç½‘ç«™ä¸­å¦‚æœæœ‰ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡çš„åŠŸèƒ½ï¼Œè¦åœ¨åç«¯è¿›è¡Œå‹ç¼©å›¾ç‰‡ä»£ç çš„ç¼–å†™ï¼Œå‹ç¼©å®Œå†ä¸Šä¼ æœåŠ¡å™¨ï¼Œå¦åˆ™åŸå›¾è¾ƒå¤§ä¼šæ¶ˆè€—å¤§é‡æµé‡

pythonæ‰¹å¤„ç†çš„ä»£ç å¦‚ä¸‹ï¼Œä½¿ç”¨ç¤ºä¾‹ï¼š

```
#80æ˜¯å‹ç¼©è´¨é‡ -cæ˜¯å¼€å§‹å‰æ¸…é™¤è¾“å‡ºç›®å½•
python compress_images.py -i my_photos -o optimized_webp -q 85 -c
```



::: details ä»£ç 

```python [æ‰¹é‡å‹ç¼©å›¾ç‰‡]
import os
import time
from datetime import timedelta
from PIL import Image
import argparse
import shutil

def compress_images(input_folder, output_folder, quality=75):
    """
    å°†è¾“å…¥æ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡å‹ç¼©ä¸ºWebPæ ¼å¼å¹¶ä¿å­˜åˆ°è¾“å‡ºæ–‡ä»¶å¤¹
    
    å‚æ•°:
    input_folder: è¾“å…¥å›¾ç‰‡æ–‡ä»¶å¤¹è·¯å¾„
    output_folder: è¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„
    quality: WebPå‹ç¼©è´¨é‡ (0-100)
    """
    # æ”¯æŒçš„å›¾ç‰‡æ ¼å¼
    valid_extensions = ('.jpg', '.jpeg', '.png', '.bmp', '.tiff', '.gif')
    
    # ç¡®ä¿è¾“å‡ºæ–‡ä»¶å¤¹å­˜åœ¨
    os.makedirs(output_folder, exist_ok=True)
    
    # åˆå§‹åŒ–ç»Ÿè®¡å˜é‡
    total_files = 0
    processed_files = 0
    skipped_files = 0
    original_total_size = 0
    compressed_total_size = 0
    start_time = time.time()
    
    print(f"ğŸ“‚ æºæ–‡ä»¶å¤¹: {os.path.abspath(input_folder)}")
    print(f"ğŸ’¾ ç›®æ ‡æ–‡ä»¶å¤¹: {os.path.abspath(output_folder)}")
    print(f"âš™ï¸ å‹ç¼©è´¨é‡: {quality}\n")
    print("=" * 60)
    
    # éå†è¾“å…¥æ–‡ä»¶å¤¹
    for filename in os.listdir(input_folder):
        input_path = os.path.join(input_folder, filename)
        
        # æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
        if filename.lower().endswith(valid_extensions):
            total_files += 1
            
            # è·å–åŸå§‹æ–‡ä»¶å¤§å°
            original_size = os.path.getsize(input_path)
            original_total_size += original_size
            
            # åˆ›å»ºè¾“å‡ºè·¯å¾„
            output_filename = os.path.splitext(filename)[0] + '.webp'
            output_path = os.path.join(output_folder, output_filename)
            
            try:
                # æ‰“å¼€å¹¶è½¬æ¢å›¾ç‰‡
                with Image.open(input_path) as img:
                    if img.mode in ('RGBA', 'LA', 'P'):
                        img = img.convert('RGBA')
                    else:
                        img = img.convert('RGB')
                    
                    # ä¿å­˜ä¸ºWebPæ ¼å¼
                    img.save(output_path, 'WEBP', quality=quality, method=6)
                
                # è·å–å‹ç¼©åæ–‡ä»¶å¤§å°
                compressed_size = os.path.getsize(output_path)
                compressed_total_size += compressed_size
                processed_files += 1
                
                # è®¡ç®—å•ä¸ªæ–‡ä»¶å‹ç¼©ç‡
                ratio = (original_size - compressed_size) / original_size * 100
                
                # æ‰“å°å•ä¸ªæ–‡ä»¶ç»“æœ
                print(f"[{processed_files}/{total_files}] âœ“ {filename} â†’ {output_filename}")
                print(f"   åŸå§‹: {format_size(original_size)} â†’ å‹ç¼©å: {format_size(compressed_size)}")
                print(f"   èŠ‚çœ: {format_size(original_size - compressed_size)} ({ratio:.1f}%)\n")
                
            except Exception as e:
                skipped_files += 1
                print(f"âœ— è·³è¿‡ {filename} - é”™è¯¯: {str(e)}\n")
    
    # è®¡ç®—æ€»å¤„ç†æ—¶é—´
    processing_time = time.time() - start_time
    
    # æ‰“å°æœ€ç»ˆç»Ÿè®¡ä¿¡æ¯
    print("=" * 60)
    print("ğŸ“Š è½¬æ¢ç»Ÿè®¡:")
    print(f"  æ‰«ææ–‡ä»¶æ€»æ•°: {total_files}")
    print(f"  æˆåŠŸè½¬æ¢: {processed_files}")
    print(f"  è·³è¿‡æ–‡ä»¶: {skipped_files}")
    print(f"  å¤„ç†æ—¶é—´: {timedelta(seconds=round(processing_time))}")
    
    # åªæœ‰å¤„ç†äº†æ–‡ä»¶æ‰æ˜¾ç¤ºå‹ç¼©ç»Ÿè®¡
    if processed_files > 0:
        # è®¡ç®—æ€»ä½“å‹ç¼©ç‡
        overall_ratio = (original_total_size - compressed_total_size) / original_total_size * 100
        
        print("\nğŸ“¦ ä½“ç§¯ç»Ÿè®¡:")
        print(f"  åŸå§‹æ€»å¤§å°: {format_size(original_total_size)}")
        print(f"  å‹ç¼©åæ€»å¤§å°: {format_size(compressed_total_size)}")
        print(f"  æ€»èŠ‚çœç©ºé—´: {format_size(original_total_size - compressed_total_size)}")
        print(f"  æ€»ä½“å‹ç¼©ç‡: {overall_ratio:.1f}%")
        
        # è®¡ç®—å¹³å‡å‹ç¼©ç‡
        avg_original = original_total_size / processed_files
        avg_compressed = compressed_total_size / processed_files
        avg_ratio = (avg_original - avg_compressed) / avg_original * 100
        print(f"\nğŸ“ˆ å¹³å‡æ¯å¼ å›¾ç‰‡:")
        print(f"  åŸå§‹: {format_size(avg_original)} â†’ å‹ç¼©å: {format_size(avg_compressed)}")
        print(f"  å¹³å‡èŠ‚çœ: {format_size(avg_original - avg_compressed)} ({avg_ratio:.1f}%)")
    
    # è¾“å‡ºæ–‡ä»¶å¤¹ä¿¡æ¯
    print(f"\nâœ… å¤„ç†å®Œæˆ! è¾“å‡ºç›®å½•: {os.path.abspath(output_folder)}")

def format_size(size_bytes):
    """å°†å­—èŠ‚å¤§å°è½¬æ¢ä¸ºæ˜“è¯»çš„æ ¼å¼"""
    if size_bytes < 1024:
        return f"{size_bytes} bytes"
    elif size_bytes < 1024 * 1024:
        return f"{size_bytes / 1024:.2f} KB"
    elif size_bytes < 1024 * 1024 * 1024:
        return f"{size_bytes / (1024 * 1024):.2f} MB"
    else:
        return f"{size_bytes / (1024 * 1024 * 1024):.2f} GB"

if __name__ == "__main__":
    # è®¾ç½®å‘½ä»¤è¡Œå‚æ•°
    parser = argparse.ArgumentParser(
        description='ğŸ“¸ æ‰¹é‡å›¾ç‰‡å‹ç¼©å·¥å…· (è½¬æ¢ä¸ºWebPæ ¼å¼)',
        formatter_class=argparse.ArgumentDefaultsHelpFormatter
    )
    parser.add_argument('-i', '--input', default='images',
                        help='è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„ (é»˜è®¤: images)')
    parser.add_argument('-o', '--output', default='compressed_webp',
                        help='è¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„ (é»˜è®¤: compressed_webp)')
    parser.add_argument('-q', '--quality', type=int, default=75,
                        help='å‹ç¼©è´¨é‡ (0-100, é»˜è®¤: 75)')
    parser.add_argument('-c', '--clean', action='store_true',
                        help='æ¸…ç©ºè¾“å‡ºç›®å½•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰')
    
    args = parser.parse_args()
    
    # éªŒè¯è´¨é‡å‚æ•°
    if args.quality < 0 or args.quality > 100:
        print("é”™è¯¯: è´¨é‡å‚æ•°å¿…é¡»åœ¨0-100ä¹‹é—´")
        exit(1)
    
    # å¦‚æœéœ€è¦æ¸…ç©ºè¾“å‡ºç›®å½•
    if args.clean and os.path.exists(args.output):
        shutil.rmtree(args.output)
        print(f"å·²æ¸…ç©ºè¾“å‡ºç›®å½•: {args.output}")
    
    # æ‰§è¡Œè½¬æ¢
    compress_images(
        input_folder=args.input,
        output_folder=args.output,
        quality=args.quality
    )
```

:::

### æ‰‹åŠ¨ä»£ç å‹ç¼©

å¯¹äºCSSã€JSä»£ç ã€æ³¨é‡Šä»£ç ç­‰ï¼Œå¯ä»¥è¿›è¡Œå‹ç¼©å¤„ç†ï¼Œæ–¹å¼ï¼šæ³¨é‡Šä»£ç å¯ä»¥åˆ é™¤ï¼Œå˜é‡åç¼©çŸ­ç­‰ç­‰ï¼Œä¸€èˆ¬çš„å‰ç«¯æ‰“åŒ…å·¥å…·å¯ä»¥è¿›è¡Œå‹ç¼©

```
function getCompressConfig() {
  return {
    minify: 'terser',//ä½¿ç”¨ Terser è¿›è¡ŒJSå‹ç¼©cssMinify:trueï¼Œ/å¯ç”¨CSSå‹ç¼–terserOptions:{
    cssMinify:true,
    terserOptions:{
      compress:{
        drop_console:true,//ç§»é™¤æ‰€æœ‰console.logè¯­å¥
        drop_debugger:true,//ç§»é™¤æ‰€æœ‰debuggerè¯­å¥
        pure_funcs:['console.log'],// é¢å¤–æŒ‡å®šè¦ç§»é™¤çš„çº¯å‡½æ•°
        passes:2// æ‰§è¡Œ 2è½®å‹ç¼©ä¼˜åŒ–
      },
      mangle:{
        toplevel:true//æ··æ·†é¡¶çº§ä½œç”¨åŸŸçš„å˜é‡å
      },
      format:{
        comments:false// ç§»é™¤æ‰€æœ‰ä»£ç æ³¨é‡Š
      }
    }
  }
}
```

è‡ªåŠ¨gzipå‹ç¼©

æµè§ˆå™¨å’ŒæœåŠ¡å™¨é—´æœ‰åè®®ï¼Œæµè§ˆå™¨åœ¨è¯·æ±‚å¤´å‘Šè¯‰æœåŠ¡å™¨å¼€å¯äº†gzipå‹ç¼©ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åå³å¯å¼€å¯å‹ç¼©ï¼Œå°†æ–‡ä»¶å‹ç¼©åå†ä¸Šä¼ ï¼Œé€šè¿‡è¯·æ±‚å¤´å‘Šè¯‰æµè§ˆå™¨æ˜¯å‹ç¼©åçš„æ–‡ä»¶ï¼Œç„¶åæµè§ˆå™¨è‡ªåŠ¨è§£å‹

![image-20250808005846658](https://yhyper.dpdns.org/photostore/2025/08/image-20250808005846658.png)

## ä¸‰ã€åŠ è½½ç­–ç•¥

### æ‡’åŠ è½½

å»¶è¿ŸåŠ è½½ç”¨æˆ·çœ‹ä¸åˆ°çš„å†…å®¹ï¼Œå½“ç”¨æˆ·æŸ¥çœ‹åˆ°æ—¶æ‰åŠ è½½ï¼Œè¿™ä¸ªå¯ä»¥æ˜¾è‘—æå‡é¦–å±æ˜¾ç¤ºæ—¶é—´ï¼ˆé€‚åˆæ»šåŠ¨ çš„å…ƒç´ ï¼‰

### æ¨¡å—åŒ–æŒ‰éœ€åŠ è½½

ç½‘ç«™çš„cssã€jsæ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼Œè®¿é—®åˆ°æŸä¸ªé¡µé¢æ—¶ï¼ŒåªåŠ è½½å¯¹äºé¡µé¢çš„csså’Œjsï¼Œä¹Ÿèƒ½æå‡è®¿é—®é€Ÿåº¦

### åˆ†å±‚åŠ è½½

å…ˆè®©ç”¨æˆ·çœ‹åˆ°å†…å®¹ï¼Œç‚¹å‡»è®¿é—®æ—¶æ‰åŠ è½½é«˜è´¨é‡å†…å®¹ï¼Œä¾‹å¦‚é¢„è§ˆæ˜¾ç¤ºç¼©ç•¥å›¾ï¼Œç‚¹å‡»åæ‰æ˜¾ç¤ºé«˜æ¸…å›¾

### æ¸è¿›å¼åŠ è½½

å’Œåˆ†å±‚ç±»ä¼¼ä½†æ›´é«˜çº§ï¼Œæ¯”å¦‚å›¾ç‰‡å…ˆæ˜¾ç¤ºæ¨¡ç³Šçš„å›¾ç‰‡é¢„è§ˆï¼Œç„¶åé€æ¸æ¸…æ™°ï¼Œè¿™æ ·å­èƒ½ä¿è¯å…ƒç´ ä¸ä¼šé”™ä½ç­‰

### é¢„åŠ è½½

é€šå¸¸ç”¨äºæ–‡ç« ç­‰å†…å®¹ï¼Œå½“ç”¨æˆ·è®¿é—®æ–‡ç« åˆ—è¡¨æ—¶ï¼Œé¢„åŠ è½½æŸäº›æ–‡ç« çš„å†…å®¹ï¼Œç‚¹å‡»è¯¦æƒ…æ—¶ç”¨æˆ·å³å¯å®ç°æ— æ„Ÿç§’è¿›çš„æ•ˆæœï¼ˆä½†æ˜¯è¦æ³¨æ„åŠ è½½çš„æ•°é‡ï¼Œæ ¹æ®æƒ…å†µåŠ è½½ï¼‰

## å››ã€è¯·æ±‚åˆå¹¶

æµè§ˆå™¨å¯èƒ½å¯¹åŒä¸€åŸŸåæœ‰è¯·æ±‚é™åˆ¶ï¼Œæ‰€ä»¥è¦è°ƒç”¨å¤šæ¬¡åç«¯æ¥å£è¯·æ±‚æ•°æ®æ—¶ï¼Œå¯èƒ½äº§ç”Ÿæ’é˜Ÿå’Œé˜»å¡ï¼Œå¯ä»¥ä¿®æ”¹åç«¯ä»£ç ï¼Œåˆå¹¶è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥æ­å»ºnodeä¸­é—´å±‚æ¥åš

tipsï¼šå›¾æ ‡æ–‡ä»¶å¯ä»¥æ•´åˆæˆä¸€ä¸ªé•¿å®½è§„èŒƒçš„æ–‡ä»¶ï¼Œåˆ©ç”¨cssé›ªç¢§å›¾ç‰¹æ€§ï¼ŒæŠŠæ‰€æœ‰å›¾æ ‡åˆå¹¶æˆä¸€å¼ ï¼Œåœ¨å‰ç«¯åˆ©ç”¨cssçš„background positionåŠ è½½å›¾ç‰‡æŒ‡å®šä½ç½®